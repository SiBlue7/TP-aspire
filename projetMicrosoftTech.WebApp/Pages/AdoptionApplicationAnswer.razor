@page "/adoption-application-answer"
@using projetMicrosoftTech.WebApp.Dtos
@attribute [Authorize(Roles = "adoptant")]
@inject IAdoptionClient adoptionClient
@inject IConfiguration Configuration
<link href="css/adoptionApplication.css" rel="stylesheet" />
<h3>Mes Demandes d'adoption</h3>

@if (requests == null)
{
    <p class="loading">Chargement...</p>
}
else if (!requests.Any())
{
    <p class="no-requests">Aucune demande d'adoption trouvée.</p>
}
else
{
    <div class="request-cards-container">
        @foreach (var req in requests)
        {
            var photoUrl = $"{Configuration["ApiBaseUrl"]}/images/{req.cat.photos?.FirstOrDefault()?.photoUrl ?? "default.png"}";

            <div class="request-card">
                <img src="@photoUrl" class="cat-photo" alt="@req.cat.name" />

                <h4>@req.cat.name</h4>

                @if (!string.IsNullOrEmpty(req.comment))
                {
                    <p class="comment">
                        <strong>Commentaire :</strong><br/>
                        @req.comment
                    </p>
                }

                <p>
                    <strong>Status :</strong>
                    <span class="status-badge @GetStatusClass(req.status)">
                        @GetStatusText(req.status)
                    </span>
                </p>
            </div>
        }
    </div>
}

@code {
    private List<AdoptionWithCatDto>? requests = null;

    protected override async Task OnInitializedAsync()
    {
        requests = await adoptionClient.GetMyAdoptionRequestsAsync();
    }

    private string GetStatusClass(AdoptionStatus s) =>
        s switch
        {
            AdoptionStatus.Valide => "status-valid",
            AdoptionStatus.Refuse => "status-rejected",
            _ => "status-pending"
        };

    private string GetStatusText(AdoptionStatus s) =>
        s switch
        {
            AdoptionStatus.Valide => "Validée",
            AdoptionStatus.Refuse => "Refusée",
            _ => "En attente"
        };
}